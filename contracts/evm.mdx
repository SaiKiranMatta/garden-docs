---
title: "EVMgoit"
description: "Implement atomic swaps on EVM-compatible blockchains using smart contracts"
---

## Contract Architecture

Garden uses Hashed Time Lock Contracts (HTLCs) to implement atomic swap functionality on EVM chains. The contract manages the lifecycle of a swap through four main operations with enhanced signature support and flexible initiation methods:

<CardGroup cols={2}>
  <Card title="Initiate" icon="play" href="#initiate">
    Start the cross-chain swap by depositing funds into the HTLC on the source chain.
  </Card>
  <Card title="Redeem" icon="check" href="#redeem">
    Complete the cross-chain swap by redeeming funds from the HTLC on the destination chain.
  </Card>
  <Card title="Refund" icon="rotate-left" href="#refund">
    Get your funds refunded on the source chain, if swap does not happen within the settlement window. 
  </Card>
  <Card title="Instant Refund" icon="bolt" href="#instant-refund">
    Cancel the swap and get an instant refund on the source chain during the settlement window.
  </Card>
</CardGroup>

## Core Functions

### Initiate

The initiate function creates a new HTLC by locking ERC20 tokens in the contract. EVM provides three flexible initiation methods:

**Basic Initiation:**
```solidity
function initiate(
    address redeemer,
    uint256 timelock,
    uint256 amount,
    bytes32 secretHash
) external
```

**Initiation on Behalf:**
```solidity
function initiateOnBehalf(
    address initiator,
    address redeemer,
    uint256 timelock,
    uint256 amount,
    bytes32 secretHash
) external
```

**Signature-Based Initiation:**
```solidity
function initiateWithSignature(
    address initiator,
    address redeemer,
    uint256 timelock,
    uint256 amount,
    bytes32 secretHash,
    bytes calldata signature
) external
```

<Note>
Uses EIP712 signatures for off-chain authorization, enabling gasless transactions where authorized third parties can initiate swaps on behalf of users.
</Note>

### Redeem

The redeem function allows the redeemer to claim the locked tokens by providing the secret that hashes to the stored secret hash.

```solidity
function redeem(
    bytes32 orderID,
    bytes calldata secret
) external
```

<Info>
The secret must hash to the exact value stored during initiation using SHA-256. Once revealed, this secret enables the counterparty to claim funds on the other chain. No signature required - anyone can execute if they know the secret.
</Info>

### Refund

The refund function allows the initiator to reclaim their tokens after the timelock has expired and the redeemer has not claimed the funds.

```solidity
function refund(bytes32 orderID) external
```

<Note>
Uses absolute block numbers for timelock, which provides predictable settlement windows based on consistent block production times.
</Note>

### Instant Refund

The instant refund function provides a way for the redeemer to consent to canceling the swap before the timelock expires using EIP712 signatures.

```solidity
function instantRefund(
    bytes32 orderID,
    bytes calldata signature
) external
```

<Warning>
Requires the redeemer's EIP712 signature to prevent unauthorized instant refunds. This ensures mutual consent before the settlement window expires.
</Warning>

## EVM-Specific Features

### State Management

The contract tracks each swap's state through an enumeration - a feature not available in Bitcoin scripts:

```solidity
enum SwapState {
    INVALID,    // Swap doesn't exist
    OPEN,       // Funds locked, awaiting redemption
    REDEEMED,   // Secret revealed, funds claimed
    REFUNDED    // Timelock expired, funds returned
}
```

### Event Logging

The contract emits events for each state transition to enable efficient off-chain monitoring:

```solidity
event SwapInitiated(bytes32 indexed swapId, address indexed initiator, address indexed redeemer);
event SwapRedeemed(bytes32 indexed swapId, bytes32 secret);
event SwapRefunded(bytes32 indexed swapId);
event SwapInstantRefunded(bytes32 indexed swapId);
```